<!DOCTYPE html>
<html lang="en" class="no-js">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>MalwareLab Project</title>
		<link rel="shortcut icon" href="../favicon.ico">
		<link rel="stylesheet" type="text/css" href="css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="css/demo.css" />
		<link rel="stylesheet" type="text/css" href="css/menu_style.css" />
		<link rel="stylesheet" type="text/css" href="css/component.css" />
		<script src="js/modernizr.custom.js"></script>
		<script src="https://use.fontawesome.com/6b924cb46d.js"></script>
	</head>
	<body>
		<div class="container">
			<div class="sample_disp">

			<div class="detail_edge_left">

				<div class="detail_box" id="hashs">
					<div class="detail_box_title">
						Hashs
					</div>
					<?php
					$id = $_GET['md5'];
					$conn = mysqli_connect("localhost:3306", "root", "toor", "MalwareLab");
					  // Check connection
					  if ($conn->connect_error) {
					   die("Connection failed: " . $conn->connect_error);
					  }
					  $sql = "SELECT * FROM Malwares WHERE md5='$id'";
					  $result = $conn->query($sql);
					  if ($result->num_rows > 0) {
						$eye_plus = '<img src="SVG/049-folder-open.svg" alt=""> ';
						$pencil = '<img src="SVG/006-pencil.svg" alt=""> ';
					  while($row = $result->fetch_assoc()) {
					   	$md5 = $row["md5"];
							$name = $row["path"];
							$size = $row["size"];
							$type = $row["type"];
							$sha256 = $row["sha256"];
							$impash = $row["impash"];
							$eset = $row["ESETNOD32"];
							$clamav = $row["ClamAV"];
							$defender = $row["Microsoft"];
							$mbytes = $row["Malwarebytes"];
							$kasper = $row["Kaspersky"];
							$gen = $row["general_infos"];
							$crypto = $row["crypto"];
							$anti = $row["antivm_debug"];
							$addit = $row["additional"];
							$peid = $row["packer_peid"];
							$yara = $row["packer"];
							$date_mod = $row["packer"];
							$date_creat = $row["packer"];
							$date_first = $row["first_seen"];
							$date_upload = $row["upload_date"];
							$score = $row["score"];
							$dll = $row["import_dll"];
							$imports = $row["imports"];
							$sections = $row["sections"];

							echo "<b>MD5: </b>" . $md5 . "<br>";
							/*echo "<b>SHA256: </b>" . $sha256 . "<br>";
							echo "<b>Impash: </b>" . $impash . "<br>";*/
						}
					} else { echo '<i style="color:red;"> /!\ ERROR, INVALID HASH IDENTIFIER /!\ <br> You can check the URL for the md5 parameter and <br> compare it with what\'s inside your database. <br> If you don\'t find what\'s wrong, you can open a <a target="_blank" href="https://github.com/GuillaumeOrlando/Malware-Analysis-Lab/issues/new">Github issue</a> </i> '; }

					?>

				</div>

				<div class="detail_box" id="infos">
					<div class="detail_box_title" >
						Infos
					</div>
					<?php
					echo "<b>Name: </b>" . $name . "<br>";
					echo "<b>Size: </b>" . $size . "<br>";
					echo "<b>Type: </b>" . $type . "<br>";
					 ?>

				</div>

				<div class="detail_box" id="detection">
					<div class="detail_box_title" >
						Anti-Virus Detection
					</div>
					<?php
					echo "<b>ESET-NOD32: </b>" . $eset . "<br>";
					echo "<b>ClamAV: </b>" . $clamav . "<br>";
					echo "<b>Defender: </b>" . $defender . "<br>";
					echo "<b>Malwarebytes: </b>" . $mbytes . "<br>";
					echo "<b>Kaspersky: </b>" . $kasper . "<br>";
					 ?>

				</div>

				<div class="detail_box" id="yara">
					<div class="detail_box_title" >
						YARA Rules
					</div>
					<?php
					$gen1 = str_replace(" |", ", " ,$gen );
					$crypto1 = str_replace(" |", ", " ,$crypto );
					$anti1 = str_replace(" |", ", " ,$anti );
					$addit1 = str_replace("|", ", " ,$addit );
					echo "<b>General infos: </b>" . $gen1 . "<br>";
					echo "<b>Cryptographic artifacts: </b>" . $crypto1 . "<br>";
					echo "<b>Anti-VM / Anti-Debug: </b>" . $anti1 . "<br>";
					echo "<b>Additional: </b>" . $addit1 . "<br>";
					 ?>
				</div>

				<div class="detail_box" id="packer">
					<div class="detail_box_title" >
						Packer
					</div>
					<?php
					echo "<b>PEiD: </b>" . $peid . "<br>";
					echo "<b>YARA: </b>" . $yara . "<br>";
					 ?>
				</div>

			</div>



			<div class="detail_edge_middle">

				<div class="detail_box" id="dates">
					<div class="detail_box_title" >
						Dates
					</div>
					<?php
					echo "<b>Upload: </b>" . $date_upload . "<br>";
					echo "<b>First Seen: </b>" . $date_first . "<br>";
					echo "<b>Creation: </b>" . $date_creat . "<br>";
					echo "<b>Modifed: </b>" . $date_mod . "<br>";
					 ?>
				</div>

				<div class="detail_box" id="ratio">
					<div class="detail_box_title" >
						VT Ratio
					</div>
					<?php
					echo "<b>Score: </b>" . $score . "<br>";
					 ?>
				</div>

				<div class="detail_box" id="tracks">
					<div class="detail_box_title" >
						OSINT
					</div>
					<?php
						echo "<b>VirusTotal: </b>" . "<a target='_blank' href='https://www.virustotal.com/gui/search/" . $md5 . "'>VirusTotal report</a> <br>";
						echo "<b>AlienVault </b>" . "<a target='_blank' href='https://otx.alienvault.com/indicator/file/" . $md5 . "'>Alien Vault OTX (Open Threat Exchange)</a> <br>";
						echo "<b>HybridAnalysis: </b>" . "<a target='_blank' href='https://www.hybrid-analysis.com/search?query=+" . $md5 . "+'>Hybris-Analysis report</a> <br>";
						echo "<b>CAPES Sandbox: </b>" . "<a target='_blank' href='https://cape.contextis.com/api/tasks/search/md5/" . $md5 . "'>CAPES Sandbox data</a> <br>";
						echo "<b>VirusBay: </b>" . "<a target='_blank' href='https://beta.virusbay.io/sample/browse?q=" . $md5 . "'>Search on VirusBay</a> <br>";
						echo "<b>Malshare: </b>" . "<a target='_blank' href='https://malshare.com/sample.php?action=detail&hash=" . $md5 . "'>Search on Malshare</a> <br>";
						echo "<b>Any.run: </b>" . "<a target='_blank' href='https://app.any.run/" . "'><s>Not available</s></a> <br>";
						echo "<b>Google: </b>" . "<a target='_blank' href='https://www.google.com/search?q=" . $md5 . "'>global search</a> <br>";
					 ?>
				</div>

				<div class="detail_box" id="pe_section">
					<div class="detail_box_title" >
						PE Sections
					</div>
					<table>
						<tr>
							<td> <b>Name</b> </td>
							<td> <b>Virtual Address</b> </td>
							<td> <b>Virtual Size</b> </td>
							<td> <b>Raw Size</b> </td>
						</tr>

					<?php
					$number_sections = substr_count($sections,"|");
					$sections_formated = str_replace(",", "|" ,$sections );
					$sections_exploded = explode ("|", $sections_formated);
					for ($xa = 0; $xa <= $number_sections * 4; $xa = $xa + 4) {
							print_r("<tr> <td>" . $sections_exploded[$xa] . "</td> <td>" . $sections_exploded[$xa + 1] . "</td> <td>" . $sections_exploded[$xa + 2]. "</td> <td>" . $sections_exploded[$xa + 3] . "</td> <td> </tr>");
					}
					 ?>

					</table>

			</div>
		</div>

		<div class="detail_edge_right">

			<div class="detail_box" id="dll">
				<div class="detail_box_title" >
					DLL
				</div>
				<?php
				$dll1 = str_replace("|", "<br>" ,$dll );
				echo $dll1;
				 ?>
			</div>



		</div>

			<div class="detail_edge_far_right">

				<div class="detail_box" id="imports">
					<div class="detail_box_title" >
						Imports
					</div>
					<?php
					$number_imports = substr_count($imports,"|");
					$imports_formated = str_replace(",", "|" ,$imports );
					$imports_exploded = explode ("|", $imports_formated);
					/* print_r($imports_exploded[0]); */
					 ?>
					<table>
						<tr>
							<td> <b>Name</b> </td>
							<td> <b>Address</b> </td>
						</tr>
						<?php
						for ($x = 0; $x <= $number_imports * 2; $x = $x + 2) {
								print_r("<tr> <td>" . $imports_exploded[$x] . "</td> <td>"  . $imports_exploded[$x + 1] . "</td>");
						}
						 ?>
				</div>

			</div>


		<?php
		$conn->close();
		 ?>
		</div><!-- /container -->
		<script src="js/classie.js"></script>
		<script src="js/gnmenu.js"></script>
		<script>
			new gnMenu( document.getElementById( 'gn-menu' ) );
		</script>
	</body>
</html>
